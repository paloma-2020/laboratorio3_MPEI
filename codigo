/*
 * File:   main.c
 * Nombre: Codigo simulacion laboratorio 3
 * Author: 
 * Paloma Alvarez peniche
 * Laura Daniela Fandi√±o
 * Created on Octubre 02, 2020, 11:04 AM
 */


 

#include "config.h"
//#include <xc.h>
#include "reloj.h"
#include <string.h> 
//#include "../h/p24F16KA102.h"
#include <libpic30.h>

 

 
int m=0;
int tiempo=350;
int tiempo_vis=48;
int main(void) {
    //Configuracion micro 
    AD1PCFG=0xFFFF;//todo como digital
    TRISB=0x0000;
    TRISBbits.TRISB11=1; //definir puerto como entrada
    //Declaracion de variables

 

 
    int i,j,k,l=0;
    //int m=0;// cambiar este valor reeplazar luego con el boton
    while(1){
        disp1(i);
        boton();
        disp2(j);
        boton();
        disp3(k);
        boton();
        disp4(l);
        boton();
        dispa(l);
        boton();
         __delay_ms(tiempo);
        // conteo ascendente 
        if (m==0){
            if(l==9& k==9 & j==9 & i==9){
                k=0;
                j=0;
                i=0;
                l=0;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            }
            if(k==9 & j==9 & i==9){
                k=0;
                j=0;
                i=0;
                l++;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            }
            if(j==9 & i==9){
                j=0;
                i=0;
                k++;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            } 
            if(i==9){
                i=0;
                j++;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            }
            i++;
        }
        else{
            // conteo ascendente
            if(l==0 & k==0 & j==0 & i==0){
                k=9;
                j=9;
                i=9;
                l=9;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            }
            if(k==0 & j==0 & i==0){
                k=9;
                j=9;
                i=9;
                l--;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            }
            if(j==0 & i==0){
                j=9;
                i=9;
                k--;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            } 
            if(i==0){
                i=9;
                j--;
                disp1(i);
                disp2(j);
                disp3(k);
                disp4(l);
                dispa(l);
            }
            i--;
        }
    }
   return 0;
}

int boton(){
    if(PORTBbits.RB11==1){
        //__delay_ms(120);
        while(PORTBbits.RB11==1); //se detecto un pulso
        if(m>1){
        m=0;
        }
        else{
        m++;
        }
    }
    return m;
};

void disp1(int a){
  //prender numero 1
    PORTBbits.RB7=0;
    PORTBbits.RB8=0;
    PORTBbits.RB9=0;
    PORTBbits.RB10=1;
    numero(a);
}

 

void disp2(int a){
  //prender numero 2
    PORTBbits.RB7=0;
    PORTBbits.RB8=0;
    PORTBbits.RB9=1;
    PORTBbits.RB10=0;
    numero(a);
}

 

void disp3(int a){
  //prender numero 3
    PORTBbits.RB7=0;
    PORTBbits.RB8=1;
    PORTBbits.RB9=0;
    PORTBbits.RB10=0;
    numero(a);
}

 

void disp4(int a){
  //prender numero 4
    PORTBbits.RB7=1;
    PORTBbits.RB8=0;
    PORTBbits.RB9=0;
    PORTBbits.RB10=0;
    numero(a);
}
void dispa(int a){  
    PORTBbits.RB7=0;
    PORTBbits.RB8=0;
    PORTBbits.RB9=0;
    PORTBbits.RB10=0;
    numero(a);
    
}
void numero(int b){
    switch(b){
            case 0: 
                cero();
            break;
            case 1: 
                uno();
            break;
            case 2:
                dos();
            break;
            case 3:
                tres();
            break;
            case 4:                
                cuatro();
            break;
            case 5:
                cinco();
            break;
            case 6:
                seis();
            break;
            case 7:
                siete();
            break;
            case 8:
                ocho();
            break;
            case 9:
                nueve();
            break;
        }
};

 


//numeros

 

void cero(){
    PORTBbits.RB0=0;
    PORTBbits.RB1=0;
    PORTBbits.RB2=0;
    PORTBbits.RB3=0;
    PORTBbits.RB4=0;
    PORTBbits.RB5=0;
    PORTBbits.RB6=1;
    __delay_ms(tiempo_vis);
 }

 void uno(){
     PORTBbits.RB0=1;
     PORTBbits.RB1=0;
     PORTBbits.RB2=0;
     PORTBbits.RB3=1;
     PORTBbits.RB4=1;
     PORTBbits.RB5=1;
     PORTBbits.RB6=1;
     __delay_ms(tiempo_vis);
 }

void dos(){
    PORTBbits.RB0=0;
    PORTBbits.RB1=0;
    PORTBbits.RB2=1;
    PORTBbits.RB3=0;
    PORTBbits.RB4=0;
    PORTBbits.RB5=1;
    PORTBbits.RB6=0;
    __delay_ms(tiempo_vis);
 }

void tres(){
    PORTBbits.RB0=0;
    PORTBbits.RB1=0;
    PORTBbits.RB2=0;
    PORTBbits.RB3=0;
    PORTBbits.RB4=1;
    PORTBbits.RB5=1;
    PORTBbits.RB6=0;
    __delay_ms(tiempo_vis);
 }

void cuatro(){
    PORTBbits.RB0=1;
    PORTBbits.RB1=0;
    PORTBbits.RB2=0;
    PORTBbits.RB3=1;
    PORTBbits.RB4=1;
    PORTBbits.RB5=0;
    PORTBbits.RB6=0;
    
    __delay_ms(tiempo_vis);
}
void cinco(){
    PORTBbits.RB0=0;
    PORTBbits.RB1=1;
    PORTBbits.RB2=0;
    PORTBbits.RB3=0;
    PORTBbits.RB4=1;
    PORTBbits.RB5=0;
    PORTBbits.RB6=0;
    __delay_ms(tiempo_vis);
 }


 void seis(){
     PORTBbits.RB0=0;
     PORTBbits.RB1=1;
     PORTBbits.RB2=0;
     PORTBbits.RB3=0;
     PORTBbits.RB4=0;
     PORTBbits.RB5=0;
     PORTBbits.RB6=0;
 __delay_ms(tiempo_vis);
 }



void siete(){
    PORTBbits.RB0=0;
    PORTBbits.RB1=0;
    PORTBbits.RB2=0;
    PORTBbits.RB3=1;
    PORTBbits.RB4=1;
    PORTBbits.RB5=1;
    PORTBbits.RB6=1;
    __delay_ms(tiempo_vis);
 }



void ocho(){
    PORTBbits.RB0=0;
    PORTBbits.RB1=0;
    PORTBbits.RB2=0;
    PORTBbits.RB3=0;
    PORTBbits.RB4=0;
    PORTBbits.RB5=0;
    PORTBbits.RB6=0;
    __delay_ms(tiempo_vis);
 }



void nueve(){
    PORTBbits.RB0=0;
    PORTBbits.RB1=0;
    PORTBbits.RB2=0;
    PORTBbits.RB3=0;
    PORTBbits.RB4=1;
    PORTBbits.RB5=0;
    PORTBbits.RB6=0;
    __delay_ms(tiempo_vis);
 }
